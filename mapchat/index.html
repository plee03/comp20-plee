<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="style.css">
    <title>Geolocation</title>
    <script src="https://maps.google.com/maps/api/js?sensor=true"></script>
    <script>
        var login = "RoyDuke";
        function getSendLocation() {
            navigator.geolocation.getCurrentPosition(function(pos) {
                lat = pos.coords.latitude;
                lng = pos.coords.longitude;
                sendLocation(lat, lng);
            })
        }
        function sendLocation(lat, lng) {
            var xhr = new XMLHttpRequest();
            var params = "login=" + login + "&lat=" + lat + "&lng=" + lng +
                         "&message=theMessage";
            xhr.open("POST", 
                     "https://secret-about-box.herokuapp.com/sendLocation",
                     true);
            xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
            xhr.setRequestHeader("Content-length", params.length);
            xhr.setRequestHeader("Connection", "close");
            xhr.onreadystatechange = function() {
                if (xhr.readyState == 4 && xhr.status == 200) {
                    var json_data = xhr.responseText;
                    initMap(lat, lng);
                }
            }
            xhr.send(params);
        }
        function initMap(lat, lng) {
            var loc = new google.maps.LatLng(lat, lng);
            var myOptions = {
                center: loc,
                zoom: 8
            };
            var map = new google.maps.Map(document.getElementById("map"), myOptions);
            var marker = new google.maps.Marker({
                position: loc,
                title: "Me" 
            });
            marker.setMap(map);
        }
    </script>
</head>
<body onload="getSendLocation()">
    <div id="map"></div>
</body>
</html>

